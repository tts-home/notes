"use strict";(self.webpackChunktts_notes=self.webpackChunktts_notes||[]).push([[9748],{7331:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>i,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var r=n(5893),a=n(1151);const o={},s="\u7f13\u5b58\u8bf7\u6c42 content \u7684 HttpServletRequest \u5305\u88c5\u7c7b",l={id:"java/tutorial/content_cached_http_servlet_request",title:"\u7f13\u5b58\u8bf7\u6c42 content \u7684 HttpServletRequest \u5305\u88c5\u7c7b",description:"",source:"@site/docs/java/tutorial/content_cached_http_servlet_request.md",sourceDirName:"java/tutorial",slug:"/java/tutorial/content_cached_http_servlet_request",permalink:"/notes/java/tutorial/content_cached_http_servlet_request",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Other",permalink:"/notes/java/snippet/other"},next:{title:"\u7c7b\u8def\u5f84\u4e0b\u8d44\u6e90\u6587\u4ef6\u7684\u52a0\u8f7d",permalink:"/notes/java/tutorial/load_classpath_resources"}},i={},p=[];function c(t){const e={code:"code",h1:"h1",pre:"pre",...(0,a.a)(),...t.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.h1,{id:"\u7f13\u5b58\u8bf7\u6c42-content-\u7684-httpservletrequest-\u5305\u88c5\u7c7b",children:"\u7f13\u5b58\u8bf7\u6c42 content \u7684 HttpServletRequest \u5305\u88c5\u7c7b"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'public static class ContentCachingHttpServletRequestWrapper extends HttpServletRequestWrapper {\n    /**\n     * request body (include application/x-www-form-urlencoded)\n     */\n    private byte[] content;\n    /**\n     * multi part\n     */\n    private final Map<String, List<Part>> partMap = new HashMap<>();\n\n    public ContentCachingHttpServletRequestWrapper(final HttpServletRequest request) throws IOException {\n        super(request);\n        final String contentType =\n                Optional.ofNullable(request.getHeader("Content-Type")).map(String::toLowerCase).orElse("");\n        if (contentType.contains("multipart/form-data")) {\n            try {\n                Optional.ofNullable(request.getParts()).filter(parts -> !parts.isEmpty())\n                        .map(parts -> parts.stream().collect(Collectors.groupingBy(Part::getName)))\n                        .ifPresent(partMap::putAll);\n            } catch (final ServletException e) {\n                // Nothing to do\n            }\n            return;\n        }\n        content = IOUtils.toByteArray(new InputStreamReader(request.getInputStream()), StandardCharsets.UTF_8);\n    }\n\n    @Override\n    public ServletInputStream getInputStream() throws IOException {\n        final ByteArrayInputStream inputStream = Optional.ofNullable(content).map(ByteArrayInputStream::new)\n                .orElseGet(() -> new ByteArrayInputStream(new byte[0]));\n        return new ServletInputStream() {\n            @Override\n            public boolean isFinished() {\n                return false;\n            }\n\n            @Override\n            public boolean isReady() {\n                return true;\n            }\n\n            @Override\n            public void setReadListener(final ReadListener readListener) {\n            }\n\n            @Override\n            public int read() throws IOException {\n                return inputStream.read();\n            }\n        };\n    }\n\n    @Override\n    public Collection<Part> getParts() throws IOException, ServletException {\n        return partMap.values().stream().flatMap(Collection::stream).collect(Collectors.toList());\n    }\n\n    @Override\n    public Part getPart(final String name) throws IOException, ServletException {\n        return Optional.ofNullable(partMap.get(name)).flatMap(parts -> parts.stream().findFirst()).orElse(null);\n    }\n\n    /**\n     * \u83b7\u53d6 content\n     *\n     * @return \u8bf7\u6c42 content\n     */\n    public byte[] getContentAsByteArray() {\n        return Optional.ofNullable(content).orElseGet(() -> new byte[0]);\n    }\n}\n'})})]})}function u(t={}){const{wrapper:e}={...(0,a.a)(),...t.components};return e?(0,r.jsx)(e,{...t,children:(0,r.jsx)(c,{...t})}):c(t)}},1151:(t,e,n)=>{n.d(e,{Z:()=>l,a:()=>s});var r=n(7294);const a={},o=r.createContext(a);function s(t){const e=r.useContext(o);return r.useMemo((function(){return"function"==typeof t?t(e):{...e,...t}}),[e,t])}function l(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(a):t.components||a:s(t.components),r.createElement(o.Provider,{value:e},t.children)}}}]);